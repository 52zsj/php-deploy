# Gitee代码同步工具配置文件
gitee:
  # Gitee仓库URL
  repo_url: "https://gitee.com/example/demo-project.git"
  # 默认分支
  default_branch: "develop"
  # 本地目录
  local_dir: "/tmp/demo-project"
  # 认证类型：ssh或password
  auth_type: "password"
  # 用户名和密码（如果auth_type为password）
  username: "username"
  password: "password"
  # SSH密钥路径（如果auth_type为ssh）
  # ssh_key: "~/.ssh/id_rsa"

# 同步选项
sync:
  rsync_options: "-az --progress"
  
  # 排除目录（删除操作时会跳过）
  exclude:
    - ".git"
    - "node_modules"
    - "vendor"
    - "*.log"
    - "runtime/"
    - "logs/"
    - "uploads/"
    - "storage/"
    - "cache/"
    - "temp/"
    - "data/"
    - "*.pid"
    - "*.lock"
  
  # 配置替换目录
  replace_dir: "~/replace/demo"

# 全局默认的同步后执行命令（优先级最低）
default_post_sync_commands:
  - "chown -R www-data:www-data {target_dir}"
  - "find {target_dir} -type d -exec chmod 755 {} \\;"
  - "find {target_dir} -type f -exec chmod 644 {} \\;"

# 服务器组
server_groups:
  - name: "测试环境"
    # 环境标识，用于选择配置替换目录
    env: "develop"
    # 服务器组级别的同步后执行命令（覆盖全局默认，优先级中等）
    post_sync_commands:
      - "chown -R nginx:nginx {target_dir}"
      - "find {target_dir} -type d -exec chmod 755 {} \\;"
      - "find {target_dir} -type f -exec chmod 644 {} \\;"
      - "systemctl reload nginx"
    servers:
      - name: "测试服务器1"
        host: "user@test-server1"
        target_dir: "/var/www/demo"
        branch: "develop"
        auth_type: "ssh"
        auth_info: "~/.ssh/id_rsa"
        # 服务器级别的同步后执行命令（优先级最高，覆盖服务器组和全局设置）
        post_sync_commands:
          - "chown -R apache:apache {target_dir}"
          - "chmod -R 755 {target_dir}"
          - "systemctl restart httpd"
      - name: "测试服务器2"
        host: "user@test-server2"
        target_dir: "/var/www/demo"
        branch: "develop"
        auth_type: "password"
        auth_info: "server_password"
        # 不配置，使用服务器组的权限设置

  - name: "生产环境"
    # 环境标识，用于选择配置替换目录
    env: "product"
    # 生产环境使用全局默认权限设置
    servers:
      - name: "生产服务器1"
        host: "user@prod-server1"
        target_dir: "/var/www/demo"
        branch: "master"
        auth_type: "ssh"
        auth_info: "~/.ssh/id_rsa"
        # 使用全局默认权限设置
      - name: "生产服务器2"
        host: "user@prod-server2"
        target_dir: "/var/www/demo"
        branch: "master"
        auth_type: "ssh"
        auth_info: "~/.ssh/id_rsa"
        # 服务器级别自定义权限
        post_sync_commands:
          - "chown -R www:www {target_dir}"
          - "find {target_dir} -name '*.php' -exec chmod 644 {} \\;"
          - "systemctl reload php-fpm"
